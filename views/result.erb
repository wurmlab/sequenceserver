<div
  class="row">
  <div
    class="<%= (report.queries.length == 1 && report.queries.first.hits.empty?) ? 'col-md-12' : 'col-md-9' %>">
    <% report.queries.each do |query| %>
      <div
          class="resultn" id="<%="Query_#{query.number}"%>"
          data-query-len="<%= query.len %>" data-graphit-target="hsps"
          data-graphit="overview" data-hit-count="<%= query.hits.count %>">
        <div
          class="page-header">
          <div
            class="row">
            <div
              class="col-md-8">
              <h3>
                Query= <%= query.id %>
                <small>
                  <%= query.title %>
                </small>
              </h3>
            </div>
            <% unless query.hits.empty? %>
              <div
                class="col-md-4 text-right">
                <div
                  class="hit-links-query">
                  <a
                    href="#"
                    class="btn btn-link download-many-sequences"
                    data-databases=<%="#{ report.querydb.map(&:id).join(' ') }"%> >
                    <i class="fa fa-download"></i>
                    Download FASTA of all hits
                  </a>
                </div>
              </div>
            <% end %>
          </div>
        </div>

        <div
          class="page-content">
          <p
            class="text-monospace">
            Query length: <%= query.len %>, Number of Hit(s): <%= query.hits.count %>
          </p>
          <% if query.hits.empty? %>
            <br>
            <br>
            <p
              class="text-monospace">
              <strong> <%= "****** No hits found ******" %> </strong>
            </p>
          <% else %>
            <table
              class="table table-hover table-condensed tabular-view text-monospace">
              <thead>
                <th>Sequences producing significant alignments</th>
                <th class="text-right"> Total Score </th>
                <th class="text-right"> E value </th>
              </thead>
              <tbody>
              <% query.hits.each do |hit| %>
                <tr>
                  <td> <a href="<%="#Query_#{query.number}_hit_#{hit.number}"%>"><%= "#{hit.id}" %></a> </td>
                  <td class="text-right"><%= '%.2f' % hit.score %></td>
                  <td class="text-right"><%= hit.evalue.to_s.sub(/(\d*\.\d*)e?([+-]\d*)?/) {|l| s = '%.3f' % $1; s << " x 10<sup>#{$2}</sup>" if $2; s} %></td>
                </tr>
              <% end %>
              </tbody>
            </table>
            <% query.hits.each do |hit| %>
              <div
                class="hitn" id="<%="Query_#{query.number}_hit_#{hit.number}"%>"
                data-hit-def="<%= hit.id %>" data-hit-evalue="<%= hit.evalue %>"
                data-hit-len="<%= hit.length %>">
                <div
                  class="page-header">
                  <h4
                    data-toggle="collapse" data-target="#<%= "Query_#{query.number}_hit_#{hit.number}_alignment" %>">
                    <i class="fa fa-chevron-down"> </i>
                    <%= hit.id %>
                    <small>
                      <%= hit.title %>
                    </small>
                  </h4>
                  <div
                    class="hit-label pull-right">
                    <%= hit.number %>
                  </div>
                </div>

                <div
                  class="page-content text-monospace collapse in"
                  id="<%="Query_#{query.number}_hit_#{hit.number}_alignment"%>">
                  Hit length: <%= hit.length %>,
                  Number of HSP(s): <%= hit.hsps.length %>
                  <% hit.hsps.each do |hsp| %>
                    <div
                      class="hsps" id="<%="Query_#{query.number}_hit_#{hit.number}_#{hsp.number}"%>"
                      data-hsp-evalue="<%= hsp.evalue %>" data-hsp-start="<%= hsp.qstart %>"
                      data-hsp-end="<%= hsp.qend %>" data-hsp-frame="<%= hsp.sframe %>">
                      <table
                        class="table table-condensed hsp-stats">
                        <thead>
                          <% report.filter_hsp_stats(hsp).each do |key, value| %>
                            <th> <%= key %> </th>
                          <% end %>
                        </thead>
                        <tbody>
                          <tr>
                            <% report.filter_hsp_stats(hsp).each do |key, value| %>
                              <td> <%= value %> </th>
                            <% end %>
                          </tr>
                        </tbody>
                      </table>
                      <div class="alignment"><%= report.pp_hsp hsp%></div>
                    </div>
                  <% end %>
                  <div class="hit-links text-right text-monospace">
                    <% report.link_per_hit(hit.accession).reverse.each_with_index do |link, i| %>
                      <%= "|" unless i == 0 %>
                      <a
                        class="<%= link[:classes].join(' ') %>"
                        href="<%= link[:url] %>" target="_blank">
                        <i class="fa <%= link[:icon].join(' ') %>"></i>
                        <%= link[:title] %>
                      </a>
                    <% end %>
                    /
                    <label>
                      <input
                      type="checkbox" class="hit-checkbox" value=<%="#{ hit.accession }"%>>
                      Select for bulk download
                    </label>
                  </div>
                </div>
              </div>
            <% end %>
          <% end %>
        </div>
      </div>
    <% end %>

    <hr>

    <div
      class="report-statistics">
<%= report.program_version %>
<br>
Databases queried:
<% report.querydb.each do |db| %>
  <%= "#{db.title}\n    #{db.nsequences} sequences, #{db.ncharacters} letters\n    created/updated on - #{db.updated_on}" %>
<% end %>

Total sequences in queried databases: <%= report.stats[0] %>
Total letters in queried databases: <%= report.stats[1] %>
    </div>
  </div>

  <% unless report.queries.length == 1 && report.queries.first.hits.empty? %>
    <div
      class="col-md-3 index-container">
      <ul
        class="nav nav-stacked index">
        <% report.queries.each do |query| %>
          <li>
            <a
              href="<%="#Query_#{query.number}"%>"
              title="<%= "Query= #{query.id}" %>">
              <%= "Query= #{query.id}" %>
            </a>
          </li>
        <% end %>
      </ul>
    </div>
  <% end %>
</div>
